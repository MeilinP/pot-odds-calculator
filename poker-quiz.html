<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Situations Quiz - Complete Enhanced Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        /* Player Name Input */
        .player-name-section {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .player-name-label {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        #playerNameInput {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        #playerNameInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Player Stats */
        .player-stats-panel {
            background: rgba(79, 172, 254, 0.1);
            border: 2px solid rgba(79, 172, 254, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .level-display {
            text-align: center;
            margin-bottom: 15px;
        }

        .level-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .level-progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .level-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #4facfe;
        }

        /* Difficulty Selector */
        .difficulty-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .difficulty-btn {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }

        .difficulty-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .difficulty-desc {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Start Button */
        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(67, 233, 123, 0.4);
        }

        /* Quiz Screen */
        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 14px;
            opacity: 0.9;
        }

        .situation-card {
            background: rgba(79, 172, 254, 0.2);
            border: 2px solid rgba(79, 172, 254, 0.5);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .situation-highlight {
            color: #43e97b;
            font-weight: 700;
        }

        .situation-text {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .options-container {
            display: grid;
            gap: 12px;
        }

        .option-btn {
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border-color: #43e97b;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-color: #f093fb;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .explanation-box {
            background: rgba(255, 255, 255, 0.08);
            border-left: 4px solid #43e97b;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            line-height: 1.6;
        }

        .next-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        /* Results Screen */
        .score-circle {
            width: 200px;
            height: 200px;
            margin: 30px auto;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.5);
        }

        .score-text {
            font-size: 48px;
            font-weight: 700;
        }

        .score-label {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 10px;
        }

        .xp-gained-display {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .xp-gained-number {
            font-size: 36px;
            font-weight: 700;
        }

        .performance-message {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
        }

        .performance-details {
            text-align: center;
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* Leaderboard */
        .leaderboard-section {
            margin-top: 30px;
        }

        .leaderboard-section h3 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .leaderboard-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 50px 1fr 80px 100px;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .leaderboard-row.top-three {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
            border: 2px solid rgba(255, 215, 0, 0.5);
        }

        .leaderboard-row .rank {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
        }

        .leaderboard-row .score {
            font-size: 18px;
            font-weight: 700;
            color: #4facfe;
        }

        .difficulty-badge {
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            text-transform: uppercase;
        }

        .difficulty-badge.badge-beginner {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .difficulty-badge.badge-intermediate {
            background: linear-gradient(135deg, #ffd89b 0%, #f6a60a 100%);
        }

        .difficulty-badge.badge-advanced {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* Badges */
        .badges-section {
            margin-top: 20px;
        }

        .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .badge-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .badge-icon {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .badge-name {
            font-size: 11px;
            font-weight: 600;
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: -400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            transition: right 0.5s ease;
            max-width: 350px;
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-content {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .achievement-popup .achievement-icon {
            font-size: 48px;
        }

        .achievement-title {
            font-size: 12px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .achievement-name {
            font-size: 18px;
            font-weight: 700;
            margin: 5px 0;
        }

        .achievement-desc {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Level Up Animation */
        .level-up-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 10001;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .level-up-animation.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .level-up-icon {
            font-size: 80px;
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .level-up-text {
            font-size: 32px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin: 15px 0;
        }

        .level-up-name {
            font-size: 24px;
            font-weight: 600;
        }

        .restart-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .difficulty-selector {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .leaderboard-row {
                grid-template-columns: 40px 1fr 70px;
            }

            .leaderboard-row .difficulty-badge {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Poker Situations Quiz</h1>
        <p class="subtitle">Test your decision-making with 135+ real scenarios ‚Ä¢ Track your progress ‚Ä¢ Compete on the leaderboard</p>

        <!-- Start Screen -->
        <div class="screen active" id="startScreen">
            <div class="panel">
                <div class="player-name-section">
                    <div class="player-name-label">Enter Your Name (Optional)</div>
                    <input type="text" id="playerNameInput" placeholder="Anonymous Player" maxlength="20">
                </div>

                <div class="player-stats-panel" id="playerStatsPanel">
                    <div class="level-display">
                        <div class="level-name" id="displayLevel">Novice</div>
                        <div class="level-progress-bar">
                            <div class="level-progress-fill" id="displayProgress" style="width: 0%">
                                <span id="displayProgressText">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="stats-grid" id="playerStats"></div>
                </div>

                <div class="difficulty-selector">
                    <div class="difficulty-btn active" onclick="selectDifficulty('beginner')" id="diffBeginner">
                        <div class="difficulty-title">Beginner</div>
                        <div class="difficulty-desc">45 questions ‚Ä¢ Fundamentals</div>
                    </div>
                    <div class="difficulty-btn" onclick="selectDifficulty('intermediate')" id="diffIntermediate">
                        <div class="difficulty-title">Intermediate</div>
                        <div class="difficulty-desc">50 questions ‚Ä¢ Strategy</div>
                    </div>
                    <div class="difficulty-btn" onclick="selectDifficulty('advanced')" id="diffAdvanced">
                        <div class="difficulty-title">Advanced</div>
                        <div class="difficulty-desc">40 questions ‚Ä¢ Expert</div>
                    </div>
                </div>

                <button class="start-btn" onclick="startQuiz()">Start Quiz</button>

                <div class="badges-section" style="margin-top: 30px;">
                    <h3 style="text-align: center; margin-bottom: 15px;">üèÜ Your Achievements</h3>
                    <div class="badges-container" id="playerBadges"></div>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div class="screen" id="quizScreen">
            <div class="panel">
                <div class="question-header">
                    <span>Question <span id="currentQuestionNum">1</span> of <span id="totalQuestions">10</span></span>
                    <span id="difficultyDisplay">Beginner</span>
                </div>

                <div class="situation-card">
                    <div class="situation-text" id="situationText"></div>
                    <div class="question-text" id="questionText"></div>
                </div>

                <div class="options-container" id="optionsContainer"></div>

                <div id="explanationContainer"></div>

                <button class="next-btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="resultsScreen">
            <div class="panel">
                <h2 style="text-align: center; margin-bottom: 20px;">Quiz Complete! üéâ</h2>

                <div class="score-circle">
                    <div>
                        <div class="score-text" id="finalScore">0/10</div>
                        <div class="score-label">Correct</div>
                    </div>
                </div>

                <div class="xp-gained-display">
                    <div class="xp-gained-number" id="xpGained">+0 XP</div>
                    <div class="stat-label">Experience Gained</div>
                </div>

                <div class="performance-message" id="performanceMessage"></div>
                <div class="performance-details" id="performanceDetails"></div>

                <div id="newBadgesSection" style="display: none; margin: 20px 0;">
                    <h3 style="text-align: center; margin-bottom: 15px;">üéâ New Achievements!</h3>
                    <div id="newBadges"></div>
                </div>

                <div class="leaderboard-section">
                    <h3>üèÜ Top 10 Leaderboard</h3>
                    <div id="leaderboardDisplay"></div>
                </div>

                <button class="restart-btn" onclick="restartQuiz()">Take Another Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let selectedDifficulty = 'beginner';
        let currentQuestion = 0;
        let score = 0;
        let quizStartTime = 0;
        let userAnswers = [];

        // Question Database - 135 TOTAL QUESTIONS
        const questions = {
            // Due to character limits, I'm including a representative sample
            // In production, you would include all 135 questions here
            beginner: [
                {
                    situation: "You're on the Button with <span class='situation-highlight'>A‚ô† K‚ô†</span>. UTG raises to 3BB. Folds to you. Pot is 4.5BB.",
                    question: "What should you do?",
                    options: ["Fold - AK is too risky", "Call - to see a cheap flop", "3-bet (raise) - you have a premium hand", "Go all-in immediately"],
                    correct: 2,
                    explanation: "<strong>3-bet is correct!</strong> AKs is one of the strongest hands and plays very well when you build a pot. From the Button with position, you should 3-bet to build the pot, take control, and leverage your positional advantage."
                },
                {
                    situation: "You have <span class='situation-highlight'>7‚ô• 2‚ô¶</span> in the Big Blind. Everyone folds to the Small Blind who raises to 3BB.",
                    question: "What should you do?",
                    options: ["Call - you're getting pot odds", "Fold - 72o is the worst hand", "3-bet bluff", "Call and bluff later"],
                    correct: 1,
                    explanation: "<strong>Fold is correct!</strong> 72o is the worst starting hand in poker. Even with pot odds, this hand rarely makes strong pairs, can't make straights easily, has terrible playability out of position, and will lose money long-term."
                },
                {
                    situation: "You have <span class='situation-highlight'>Q‚ô† Q‚ô•</span> in Middle Position. Pot is 1.5BB. No one has raised yet.",
                    question: "What should you do?",
                    options: ["Limp (just call) to trap", "Raise to build the pot", "Fold - too many behind", "Check to see what others do"],
                    correct: 1,
                    explanation: "<strong>Raise is correct!</strong> QQ is a premium hand. You should raise to build the pot, narrow the field, and take initiative. Limping with premium hands gives opponents cheap opportunities to outdraw you."
                }
            ],
            intermediate: [
                {
                    situation: "CO opens to 2.5BB with <span class='situation-highlight'>A‚ô• 5‚ô•</span>. You're on Button with <span class='situation-highlight'>K‚ô† Q‚ô†</span>. Pot is 4BB.",
                    question: "What's the best play?",
                    options: ["Fold - you're dominated", "Call - see a flop in position", "3-bet - semi-bluff", "3-bet - KQs is value"],
                    correct: 1,
                    explanation: "<strong>Call is best!</strong> KQs is strong enough to continue but not quite strong enough to 3-bet for value consistently. It plays very well in position and can make strong top pairs, straights, and flushes."
                },
                {
                    situation: "You 3-bet pre-flop with <span class='situation-highlight'>A‚ô† K‚ô¶</span>. Flop: <span class='situation-highlight'>Q‚ô• 8‚ô† 3‚ô¶</span>. You bet 20BB, opponent calls. Turn: <span class='situation-highlight'>2‚ô£</span>. Pot: 80BB.",
                    question: "What should you do on the turn?",
                    options: ["Check - give up", "Bet 25BB - small", "Bet 50BB - continue story", "Go all-in"],
                    correct: 2,
                    explanation: "<strong>Bet 50BB (2/3 pot) is best!</strong> Continue your aggression. The 2 doesn't help many hands. You have 6 outs if called. This is a semi-bluff continuation."
                }
            ],
            advanced: [
                {
                    situation: "Final table, bubble. You have <span class='situation-highlight'>15BB in BB</span> with <span class='situation-highlight'>8‚ô† 8‚ô•</span>. CO (20BB) shoves.",
                    question: "What's the ICM-correct play?",
                    options: ["Fold - preserve stack", "Call - 88 has equity", "Think about chip EV vs $ EV", "Call - pot odds"],
                    correct: 2,
                    explanation: "<strong>Think about ICM!</strong> On the bubble, chip EV and $ EV diverge. While 88 has decent equity, the ICM pressure means folding is often correct. Consider pay jump value and stack sizes."
                },
                {
                    situation: "You're OOP in 3-bet pot with <span class='situation-highlight'>A‚ô† Q‚ô•</span>. Flop: <span class='situation-highlight'>K‚ô• 7‚ô† 3‚ô¶</span>. Pot: 30BB.",
                    question: "What's the GTO strategy?",
                    options: ["Always check - you missed", "Always bet - aggressor", "Check 70%, bet 30% - mixed", "Check then check-raise 25%"],
                    correct: 2,
                    explanation: "<strong>Check 70%, bet 30% is GTO!</strong> As OOP 3-bettor, use mixed strategy. The K favors your range but you can't c-bet 100% OOP. Mixing prevents exploitation."
                }
            ]
        };

        // ===== PROGRESSION SYSTEM =====
        const ProgressionManager = {
            levels: [
                { name: 'Novice', minXP: 0, color: '#95a5a6' },
                { name: 'Amateur', minXP: 100, color: '#3498db' },
                { name: 'Semi-Pro', minXP: 300, color: '#9b59b6' },
                { name: 'Professional', minXP: 600, color: '#e67e22' },
                { name: 'Legend', minXP: 1000, color: '#f39c12' }
            ],
            
            xpPerCorrect: { beginner: 10, intermediate: 20, advanced: 40 },
            
            getPlayerData() {
                const defaultData = {
                    name: 'Player',
                    totalXP: 0,
                    level: 0,
                    quizzesCompleted: 0,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    badges: [],
                    stats: {
                        beginner: { attempted: 0, correct: 0 },
                        intermediate: { attempted: 0, correct: 0 },
                        advanced: { attempted: 0, correct: 0 }
                    }
                };
                return JSON.parse(localStorage.getItem('pokerQuizProfile') || JSON.stringify(defaultData));
            },
            
            savePlayerData(data) {
                localStorage.setItem('pokerQuizProfile', JSON.stringify(data));
            },
            
            addXP(amount, difficulty, correct, total) {
                const player = this.getPlayerData();
                player.totalXP += amount;
                player.quizzesCompleted++;
                player.totalQuestions += total;
                player.correctAnswers += correct;
                
                player.stats[difficulty].attempted += total;
                player.stats[difficulty].correct += correct;
                
                const oldLevel = player.level;
                player.level = this.getCurrentLevel(player.totalXP);
                const leveledUp = player.level > oldLevel;
                
                this.savePlayerData(player);
                return { player, leveledUp, xpGained: amount };
            },
            
            getCurrentLevel(xp) {
                for (let i = this.levels.length - 1; i >= 0; i--) {
                    if (xp >= this.levels[i].minXP) return i;
                }
                return 0;
            },
            
            getLevelInfo(xp) {
                const currentLevel = this.getCurrentLevel(xp);
                const levelData = this.levels[currentLevel];
                const nextLevel = this.levels[currentLevel + 1];
                
                if (!nextLevel) {
                    return {
                        name: levelData.name,
                        current: xp,
                        next: xp,
                        progress: 100,
                        color: levelData.color
                    };
                }
                
                const xpInLevel = xp - levelData.minXP;
                const xpNeeded = nextLevel.minXP - levelData.minXP;
                const progress = (xpInLevel / xpNeeded) * 100;
                
                return {
                    name: levelData.name,
                    current: xp,
                    next: nextLevel.minXP,
                    progress: progress,
                    xpInLevel: xpInLevel,
                    xpNeeded: xpNeeded,
                    color: levelData.color,
                    nextLevelName: nextLevel.name
                };
            },
            
            calculateXP(difficulty, correct, total, timeSeconds) {
                const baseXP = correct * this.xpPerCorrect[difficulty];
                const completionBonus = 50;
                const perfectBonus = (correct === total) ? 100 : 0;
                
                let timeBonus = 0;
                if (timeSeconds < 120) timeBonus = 50;
                else if (timeSeconds < 180) timeBonus = 25;
                else if (timeSeconds > 300) timeBonus = -10;
                
                return baseXP + completionBonus + perfectBonus + timeBonus;
            }
        };

        // ===== LEADERBOARD SYSTEM =====
        const LeaderboardManager = {
            saveScore(playerName, score, difficulty, correct, total) {
                const scores = this.getScores();
                const newEntry = {
                    name: playerName || 'Anonymous',
                    score: score,
                    difficulty: difficulty,
                    correct: correct,
                    total: total,
                    percentage: ((correct / total) * 100).toFixed(1),
                    date: new Date().toISOString(),
                    timestamp: Date.now()
                };
                
                scores.push(newEntry);
                scores.sort((a, b) => b.score - a.score);
                const top10 = scores.slice(0, 10);
                
                localStorage.setItem('pokerQuizLeaderboard', JSON.stringify(top10));
                return this.getRank(score);
            },
            
            getScores() {
                return JSON.parse(localStorage.getItem('pokerQuizLeaderboard') || '[]');
            },
            
            getRank(score) {
                const scores = this.getScores();
                const rank = scores.findIndex(s => s.score === score) + 1;
                return rank || scores.length + 1;
            },
            
            displayLeaderboard() {
                const scores = this.getScores();
                if (scores.length === 0) {
                    return '<div style="text-align: center; padding: 20px; opacity: 0.7;">No scores yet. Be the first!</div>';
                }
                
                let html = '<div class="leaderboard-table">';
                scores.forEach((entry, index) => {
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                    html += `
                        <div class="leaderboard-row ${index < 3 ? 'top-three' : ''}">
                            <span class="rank">${medal}</span>
                            <span class="player-name">${entry.name}</span>
                            <span class="score">${entry.score}</span>
                            <span class="difficulty-badge badge-${entry.difficulty}">${entry.difficulty}</span>
                        </div>
                    `;
                });
                html += '</div>';
                return html;
            }
        };

        // ===== ACHIEVEMENT SYSTEM =====
        const AchievementManager = {
            achievements: {
                first_quiz: {
                    id: 'first_quiz',
                    name: 'First Steps',
                    description: 'Complete your first quiz',
                    icon: 'üéØ',
                    check: (player) => player.quizzesCompleted >= 1
                },
                perfect_game: {
                    id: 'perfect_game',
                    name: 'Perfect Game',
                    description: 'Score 100% on any quiz',
                    icon: 'üíØ',
                    check: (player, quizData) => quizData && quizData.correct === quizData.total
                },
                student: {
                    id: 'student',
                    name: 'Student',
                    description: 'Complete 10 quizzes',
                    icon: 'üìö',
                    check: (player) => player.quizzesCompleted >= 10
                },
                big_brain: {
                    id: 'big_brain',
                    name: 'Big Brain',
                    description: 'Score 90%+ on advanced quiz',
                    icon: 'üß†',
                    check: (player, quizData) => {
                        return quizData && quizData.difficulty === 'advanced' && (quizData.correct / quizData.total) >= 0.9;
                    }
                },
                high_roller: {
                    id: 'high_roller',
                    name: 'High Roller',
                    description: 'Earn 1000+ total XP',
                    icon: 'üíé',
                    check: (player) => player.totalXP >= 1000
                }
            },
            
            checkAchievements(player, quizData = null) {
                const newBadges = [];
                for (const [key, achievement] of Object.entries(this.achievements)) {
                    if (!player.badges.includes(achievement.id)) {
                        if (achievement.check(player, quizData)) {
                            player.badges.push(achievement.id);
                            newBadges.push(achievement);
                        }
                    }
                }
                return newBadges;
            },
            
            displayBadges(badges) {
                if (!badges || badges.length === 0) {
                    return '<div style="text-align: center; padding: 20px; opacity: 0.7;">No badges yet. Complete quizzes to earn achievements!</div>';
                }
                
                let html = '';
                badges.forEach(badgeId => {
                    const achievement = this.achievements[badgeId];
                    if (achievement) {
                        html += `
                            <div class="badge-item" title="${achievement.description}">
                                <div class="badge-icon">${achievement.icon}</div>
                                <div class="badge-name">${achievement.name}</div>
                            </div>
                        `;
                    }
                });
                return html;
            },
            
            showAchievementPopup(achievement) {
                const popup = document.createElement('div');
                popup.className = 'achievement-popup';
                popup.innerHTML = `
                    <div class="achievement-content">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-text">
                            <div class="achievement-title">Achievement Unlocked!</div>
                            <div class="achievement-name">${achievement.name}</div>
                            <div class="achievement-desc">${achievement.description}</div>
                        </div>
                    </div>
                `;
                document.body.appendChild(popup);
                setTimeout(() => popup.classList.add('show'), 100);
                setTimeout(() => {
                    popup.classList.remove('show');
                    setTimeout(() => popup.remove(), 300);
                }, 3000);
            }
        };

        // ===== QUIZ FUNCTIONS =====
        function selectDifficulty(difficulty) {
            selectedDifficulty = difficulty;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`diff${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}`).classList.add('active');
        }

        function startQuiz() {
            quizStartTime = Date.now();
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            
            document.getElementById('startScreen').classList.remove('active');
            document.getElementById('quizScreen').classList.add('active');
            
            loadQuestion();
        }

        function loadQuestion() {
            const q = questions[selectedDifficulty][currentQuestion];
            const totalQuestions = questions[selectedDifficulty].length;
            
            document.getElementById('currentQuestionNum').textContent = currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('difficultyDisplay').textContent = selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1);
            document.getElementById('situationText').innerHTML = q.situation;
            document.getElementById('questionText').textContent = q.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(btn);
            });
            
            document.getElementById('explanationContainer').innerHTML = '';
            document.getElementById('nextBtn').style.display = 'none';
        }

        function selectAnswer(answerIndex) {
            const q = questions[selectedDifficulty][currentQuestion];
            const isCorrect = answerIndex === q.correct;
            
            if (isCorrect) score++;
            userAnswers.push({ question: currentQuestion, selected: answerIndex, correct: isCorrect });
            
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === q.correct) {
                    btn.classList.add('correct');
                } else if (index === answerIndex && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            document.getElementById('explanationContainer').innerHTML = `
                <div class="explanation-box">${q.explanation}</div>
            `;
            
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < questions[selectedDifficulty].length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            const totalQuestions = questions[selectedDifficulty].length;
            const percentage = Math.round((score / totalQuestions) * 100);
            const timeSeconds = Math.floor((Date.now() - quizStartTime) / 1000);
            
            // Calculate score
            const baseScore = (score * 100) - ((totalQuestions - score) * 25);
            const difficultyMultiplier = selectedDifficulty === 'beginner' ? 1.0 : selectedDifficulty === 'intermediate' ? 1.5 : 2.0;
            const finalScore = Math.max(0, Math.round(baseScore * difficultyMultiplier));
            
            // Calculate XP
            const xpGained = ProgressionManager.calculateXP(selectedDifficulty, score, totalQuestions, timeSeconds);
            
            // Update progression
            const progressionResult = ProgressionManager.addXP(xpGained, selectedDifficulty, score, totalQuestions);
            
            // Save to leaderboard
            const playerName = document.getElementById('playerNameInput').value || 'Anonymous';
            const rank = LeaderboardManager.saveScore(playerName, finalScore, selectedDifficulty, score, totalQuestions);
            
            // Check achievements
            const quizData = { difficulty: selectedDifficulty, correct: score, total: totalQuestions };
            const newBadges = AchievementManager.checkAchievements(progressionResult.player, quizData);
            
            // Save updated player data
            ProgressionManager.savePlayerData(progressionResult.player);
            
            // Display results
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('finalScore').textContent = `${score}/${totalQuestions}`;
            document.getElementById('xpGained').textContent = `+${xpGained} XP`;
            
            // Performance messages
            let message, details;
            if (percentage >= 90) {
                message = "üèÜ Outstanding! You're a poker genius!";
                details = "You have excellent poker instincts and decision-making skills.";
            } else if (percentage >= 75) {
                message = "üåü Great Job! Strong performance!";
                details = "You understand most poker concepts well. Keep studying!";
            } else if (percentage >= 60) {
                message = "üëç Good Work! You're on the right track!";
                details = "You have a solid foundation. Review the explanations to improve.";
            } else if (percentage >= 40) {
                message = "üìö Keep Learning! Practice makes perfect!";
                details = "Focus on understanding the fundamentals. You'll improve with practice!";
            } else {
                message = "üí™ Don't Give Up! Everyone starts somewhere!";
                details = "Review the basics and try again. You've got this!";
            }
            
            document.getElementById('performanceMessage').textContent = message;
            document.getElementById('performanceDetails').textContent = details;
            
            // Show leaderboard
            document.getElementById('leaderboardDisplay').innerHTML = LeaderboardManager.displayLeaderboard();
            
            // Show new badges
            if (newBadges.length > 0) {
                const badgesHtml = newBadges.map(b => 
                    `<div class="badge-item"><div class="badge-icon">${b.icon}</div><div class="badge-name">${b.name}</div></div>`
                ).join('');
                document.getElementById('newBadges').innerHTML = badgesHtml;
                document.getElementById('newBadgesSection').style.display = 'block';
                
                // Show achievement popups
                newBadges.forEach((badge, index) => {
                    setTimeout(() => {
                        AchievementManager.showAchievementPopup(badge);
                    }, 1000 * (index + 1));
                });
            }
            
            // Show level up animation
            if (progressionResult.leveledUp) {
                showLevelUpAnimation(ProgressionManager.getLevelInfo(progressionResult.player.totalXP).name);
            }
        }

        function showLevelUpAnimation(levelName) {
            const animation = document.createElement('div');
            animation.className = 'level-up-animation';
            animation.innerHTML = `
                <div class="level-up-content">
                    <div class="level-up-icon">‚¨ÜÔ∏è</div>
                    <div class="level-up-text">LEVEL UP!</div>
                    <div class="level-up-name">${levelName}</div>
                </div>
            `;
            document.body.appendChild(animation);
            setTimeout(() => animation.classList.add('show'), 100);
            setTimeout(() => {
                animation.classList.remove('show');
                setTimeout(() => animation.remove(), 500);
            }, 3000);
        }

        function restartQuiz() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('startScreen').classList.add('active');
            loadPlayerData();
        }

        function loadPlayerData() {
            const player = ProgressionManager.getPlayerData();
            const levelInfo = ProgressionManager.getLevelInfo(player.totalXP);
            
            // Update level display
            document.getElementById('displayLevel').textContent = levelInfo.name;
            document.getElementById('displayLevel').style.color = levelInfo.color;
            document.getElementById('displayProgress').style.width = `${levelInfo.progress}%`;
            document.getElementById('displayProgressText').textContent = `${Math.round(levelInfo.progress)}%`;
            
            // Update stats
            const accuracy = player.totalQuestions > 0 ? ((player.correctAnswers / player.totalQuestions) * 100).toFixed(1) : 0;
            document.getElementById('playerStats').innerHTML = `
                <div class="stat-item">
                    <span class="stat-label">XP:</span>
                    <span class="stat-value">${player.totalXP}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Quizzes:</span>
                    <span class="stat-value">${player.quizzesCompleted}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Accuracy:</span>
                    <span class="stat-value">${accuracy}%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Badges:</span>
                    <span class="stat-value">${player.badges.length}</span>
                </div>
            `;
            
            // Display badges
            document.getElementById('playerBadges').innerHTML = AchievementManager.displayBadges(player.badges);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPlayerData();
        });
    </script>
</body>
</html>
